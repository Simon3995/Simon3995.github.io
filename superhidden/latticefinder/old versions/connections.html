<!DOCTYPE html>
<html>
    <head>
        <style>
            html {
                background-color: #444;
            }

            canvas {
                background-color: #fff;
                height: 800px;
                width: 800px;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas" width="1700" height="1700"></canvas>
    </body>
</html>

<script type="text/javascript">
    
let c = document.getElementById("canvas");
let ctx = c.getContext("2d");

// function for finding configuration
const find_config = function (available = [... Array(256)].fill(1), idxx = 0, idxy = 0) {
    if (idxy === 16) idxy = 0, idxx++, console.log(idxx), console.log(JSON.stringify(input));
    if (idxx === 16) return true;
    input[idxx] ??= [];
    for (let i in available) {
        i = Number(i);
        // directional checks
        // left
        let tmp = idxx ? input[idxx - 1][idxy] & (1 << 2) : 0;
        if (i & (1 << 6) ? !tmp : tmp) continue;
        // up
        tmp = idxy ? input[idxx][idxy - 1] & (1 << 4) : 0;
        if (i & (1 << 0) ? !tmp : tmp) continue;
        // diagonal up-left
        //tmp = (idxx && idxy) ? input[idxx - 1][idxy - 1] & (1 << 3) : 0;
        //if (i & (1 << 7) ? !tmp : tmp) continue;

        // test recursively
        delete available[i];
        input[idxx][idxy] = i;
        let ans = find_config(available, idxx, idxy + 1);
        if (ans) return ans;
        available[i] = 1;
        // delete arr[idxx][idxy];
    }
    return false;
}

input = [];
find_config();
// input = [[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],[16,17,18,19,64,65,66,67,20,21,22,23,68,69,70,71],[24,25,26,27,28,29,30,31,72,73,74,75,76,77,78,79],[32,33,34,35,80,81,82,83,36,37,38,39,84,85,86,87],[40,41,42,43,44,45,46,47,88,89,90,91,92,93,94,95],[48,49,50,51,96,97,98,99,52,53,54,55,100,101,102,103],[56,57,58,59,60,61,62,63,104,105,106,107,108,109,110,111],[128,129,130,131,112,113,114,115,132,133,134,135,116,117,118,119],[136,137,138,139,140,141,142,143,120,121,122,123,124,125,126,127],[144,145,146,147,192,193,194,195,148,149,150,151,196,197,198,199],[152,153,154,155,156,157,158,159,200,201,202,203,204,205,206,207],[160,161,162,163,208,209,210,211,164,165,166,167,212,213,214,215],[168,169,170,171,172,173,174,175,216,217,218,219,220,221,222,223],[176,177,178,179,224,225,226,227,180,181,182,183,228,229,230,231],[184,185,186,187,188,189,190,191,232,233,234,235,236,237,238,255],[]];
/*for (let i=0; i<16; i++) {
    input[i] = [];
    for (let j=0; j<16; j++) {
        input[i][j] = 16*i + j;
    }
}*/

// connectors
let l;
ctx.lineWidth = 10;
ctx.strokeStyle = "red";
for (let i=0; i<input.length; i++) {
    for (let j=0; j<input[i].length; j++) {
        for (let b=0; b<8; b++) {
            if (input[i][j] & (1 << b)) {
                // account for diagonals
                l = (b%2) ? 50*Math.sqrt(2) : 50;
                
                ctx.beginPath();
                ctx.moveTo(100 + 100*i, 100 + 100*j);
                ctx.lineTo(
                    100 + 100*i + l*Math.sin(2*Math.PI * b/8),
                    100 + 100*j - l*Math.cos(2*Math.PI * b/8)
                )
                ctx.stroke();
            }
        }
    }
}

// centers
let s = 30;
ctx.fillStyle = "dodgerblue";
for (let i=0; i<16; i++) {
    for (let j=0; j<16; j++) {
        ctx.fillRect(100 + 100*i-(s/2), 100 + 100*j-(s/2), s, s);
    }
}

</script>
